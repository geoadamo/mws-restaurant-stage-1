class DBHelper{static get DATABASE_URL(){return"http://localhost:1337/restaurants/"}static openDB(){return idb.open("adamoDB",1,t=>{t.createObjectStore("restaurants",{keyPath:"id"})})}static saveRestaurantsToDB(t){return"indexedDB"in window?DBHelper.openDB().then(e=>{const a=e.transaction("restaurants","readwrite"),n=a.objectStore("restaurants");return Promise.all(t.map(t=>n.put(t))).then(()=>t).catch(()=>{throw a.abort(),Error("Restaurants were not added to db")})}):null}static getLocalRestaurantsData(){return"indexedDB"in window?DBHelper.openDB().then(t=>t.transaction("restaurants").objectStore("restaurants").getAll()).then(t=>t):null}static getLocalRestaurantsDataById(t){return"indexedDB"in window?DBHelper.openDB().then(e=>e.transaction("restaurants").objectStore("restaurants").get(parseInt(t))).then(t=>t):null}static fetchRestaurants(t){fetch(DBHelper.DATABASE_URL).then(t=>t.json()).then(t=>DBHelper.saveRestaurantsToDB(t)).then(e=>t(null,e)).catch(e=>{DBHelper.getLocalRestaurantsData().then(e=>t(null,e))})}static fetchRestaurantById(t,e){fetch(`${DBHelper.DATABASE_URL}${t}`).then(t=>t.json()).then(t=>e(null,t)).catch(a=>{DBHelper.getLocalRestaurantsDataById(t).then(t=>e(null,t))})}static fetchRestaurantByCuisine(t,e){DBHelper.fetchRestaurants((a,n)=>{if(a)e(a,null);else{const a=n.filter(e=>e.cuisine_type==t);e(null,a)}})}static fetchRestaurantByNeighborhood(t,e){DBHelper.fetchRestaurants((a,n)=>{if(a)e(a,null);else{const a=n.filter(e=>e.neighborhood==t);e(null,a)}})}static fetchRestaurantByCuisineAndNeighborhood(t,e,a){DBHelper.fetchRestaurants((n,r)=>{if(n)a(n,null);else{let n=r;"all"!=t&&(n=n.filter(e=>e.cuisine_type==t)),"all"!=e&&(n=n.filter(t=>t.neighborhood==e)),a(null,n)}})}static fetchNeighborhoods(t){DBHelper.fetchRestaurants((e,a)=>{if(e)t(e,null);else{const e=a.map((t,e)=>a[e].neighborhood),n=e.filter((t,a)=>e.indexOf(t)==a);t(null,n)}})}static fetchCuisines(t){DBHelper.fetchRestaurants((e,a)=>{if(e)t(e,null);else{const e=a.map((t,e)=>a[e].cuisine_type),n=e.filter((t,a)=>e.indexOf(t)==a);t(null,n)}})}static urlForRestaurant(t){return`./restaurant.html?id=${t.id}`}static imageUrlForRestaurant(t,e=!1){let a="noimage",n=".jpg";switch(navigator.userAgent.indexOf("Chrome")>-1&&(n=".webp"),t.photograph&&(a=t.photograph),e){case!1:return`img/${a}${n}`;case!0:return`img/small/${a}${n}`}}static mapMarkerForRestaurant(t,e){return new google.maps.Marker({position:t.latlng,title:t.name,url:DBHelper.urlForRestaurant(t),map:e,animation:google.maps.Animation.DROP})}}