let restaurants,neighborhoods,cuisines;var map,observer,markers=[];let imgLoaded=[];window.initMap=(()=>{self.map=new google.maps.Map(document.getElementById("map"),{zoom:12,center:{lat:40.722216,lng:-73.987501},scrollwheel:!1}),self.restaurants&&0==self.markers.length&&addMarkersToMap()}),document.addEventListener("DOMContentLoaded",e=>{createObserver(),fetchNeighborhoods(),fetchCuisines(),updateRestaurants()}),createObserver=(()=>{self.observer=new IntersectionObserver(handleIntersect,{root:null,rootMargin:"0px 0px 0px 0px"})}),handleIntersect=((e,t)=>{e.forEach(function(e){e.isIntersecting&&!imgLoaded.includes(e.target.getAttribute("data-id"))&&(lazy_load(e.target),self.observer.unobserve(e.target))})}),lazy_load=(e=>{let t=parseInt(e.getAttribute("data-id"));imgLoaded.push(t);let s=self.restaurants.find(function(e){return e.id===t}),n=document.getElementById(`img-${t}`);n.setAttribute("src",DBHelper.imageUrlForRestaurant(s,!0)),n.style.visibility="visible"}),fetchNeighborhoods=(()=>{DBHelper.fetchNeighborhoods((e,t)=>{e?console.error(e):(self.neighborhoods=t,fillNeighborhoodsHTML())})}),fillNeighborhoodsHTML=((e=self.neighborhoods)=>{const t=document.getElementById("neighborhoods-select");e.forEach(e=>{const s=document.createElement("option");s.innerHTML=e,s.value=e,t.append(s)})}),fetchCuisines=(()=>{DBHelper.fetchCuisines((e,t)=>{e?console.error(e):(self.cuisines=t,fillCuisinesHTML())})}),fillCuisinesHTML=((e=self.cuisines)=>{const t=document.getElementById("cuisines-select");e.forEach(e=>{const s=document.createElement("option");s.innerHTML=e,s.value=e,t.append(s)})}),updateRestaurants=(()=>{const e=document.getElementById("cuisines-select"),t=document.getElementById("neighborhoods-select"),s=e.selectedIndex,n=t.selectedIndex,r=e[s].value,a=t[n].value;DBHelper.fetchRestaurantByCuisineAndNeighborhood(r,a,(e,t)=>{e?console.error(e):(resetRestaurants(t),fillRestaurantsHTML(),document.getElementById("filtered-results").innerHTML=`<p>${t.length} Results</p>`)})}),resetRestaurants=(e=>{self.restaurants=[],document.getElementById("restaurants-list").innerHTML="",self.markers.forEach(e=>e.setMap(null)),self.markers=[],self.restaurants=e}),fillRestaurantsHTML=((e=self.restaurants)=>{const t=document.getElementById("restaurants-list");e.forEach(e=>{t.append(createRestaurantHTML(e))}),self.map&&addMarkersToMap()}),createRestaurantHTML=(e=>{const t=document.createElement("div");t.className="restaurant-item",t.setAttribute("data-id",e.id);const s=document.createElement("img");s.className="restaurant-img",s.setAttribute("id",`img-${e.id}`),s.style.visibility="hidden",s.alt=e.name+` ${e.cuisine_type} Restaurant`,t.append(s);const n=document.createElement("h2");n.innerHTML=e.name,t.append(n);const r=document.createElement("p");r.innerHTML=e.neighborhood,t.append(r);const a=document.createElement("p");a.innerHTML=e.address,t.append(a);const o=document.createElement("a");return o.innerHTML="View Details",o.setAttribute("aria-label",`View details about ${e.name} Restaurant`),o.href=DBHelper.urlForRestaurant(e),t.append(o),self.observer.observe(t),t}),addMarkersToMap=((e=self.restaurants)=>{e.forEach(e=>{const t=DBHelper.mapMarkerForRestaurant(e,self.map);google.maps.event.addListener(t,"click",()=>{window.location.href=t.url}),self.markers.push(t)})});